@page "{id:int}"
@model Suzy.Pages.MockTest.ResultModel
@{
    ViewData["Title"] = "Test Result";
    Layout = "_Layout";
}

<style>
    .futuristic-card { border-radius: 2rem; padding: 2rem; border: 1px solid #00bcd4; margin-top: 2rem; background: rgba(255, 255, 255, 0.85); }
    .question-block { margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
    .correct-answer { background-color: #d4edda; border-color: #c3e6cb; border-radius: 5px; }
    .wrong-answer { background-color: #f8d7da; border-color: #f5c6cb; border-radius: 5px; }
    .futuristic-btn { background: linear-gradient(145deg, #00acc1, #008ba3); border: none; padding: 0.85rem; color: white; border-radius: 16px; width: 100%; }
</style>

<div class="page-container">
    @await Html.PartialAsync("_Sidebar")
    <div class="page-content p-4">
        @if (Model.TestResult != null)
        {
            <div class="futuristic-card">
                <h3>Test Result</h3>
                <p>Taken on: @Model.TestResult.Timestamp.ToString("g")</p>
                <h4>Your Score: @Model.TestResult.Score / @Model.TestResult.TotalQuestions</h4>
                
                @if (Model.TestResult.SourceDocuments.Any())
                {
                    <div class="mt-3 mb-4">
                        <h6 class="text-muted">Test Generated From:</h6>
                        <ul class="list-group list-group-flush">
                        @foreach (var doc in Model.TestResult.SourceDocuments)
                        {
                            <li class="list-group-item bg-transparent">
                                <i class="fas fa-file-alt me-2"></i> <strong>@doc.SourceDocumentName</strong> (@doc.SourceDocumentType)
                            </li>
                        }
                        </ul>
                    </div>
                }

                <hr />

                @foreach (var result in Model.TestResult.Questions)
                {
                    <div class="question-block">
                        <p><strong>@result.QuestionText</strong></p>
                        @foreach (var option in result.Options)
                        {
                            var isCorrect = option == result.CorrectAnswer;
                            var isUserChoice = option == result.UserAnswer;
                            string bgClass = "";
                            if (isCorrect) bgClass = "correct-answer";
                            else if (isUserChoice) bgClass = "wrong-answer";

                            <div class="p-2 my-1 @bgClass">
                                @option
                                @if(isCorrect) { <i class="fas fa-check-circle text-success ms-2"></i> }
                                @if(isUserChoice && !isCorrect) { <i class="fas fa-times-circle text-danger ms-2"></i> }
                            </div>
                        }
                    </div>
                }
                <a href="/MockTest/Index" class="futuristic-btn" style="text-decoration:none; display:block; text-align:center; max-width: 200px; margin: 2rem auto 0;">Create New Test</a>
            </div>
        }
        else
        {
            <div class="alert alert-warning">Test result not found.</div>
        }
    </div>
</div>